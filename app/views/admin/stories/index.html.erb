<section class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1>Duyệt Story AI</h1>
      </div>
      <div class="col-sm-6 text-right">
        <a href="<%= new_admin_story_path %>" class="btn btn-primary">
          <i class="fas fa-plus"></i> Tạo thủ công
        </a>
      </div>
    </div>
  </div>
</section>

<section class="content">
  <div class="container-fluid">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Danh sách Story</h3>
      </div>

      <div class="card-body table-responsive p-0">
        <table class="table table-hover text-nowrap align-middle">
          <thead>
          <tr>
            <th style="width: 50px">ID</th>
            <th style="width: 100px">Kanji</th>
            <th>Nội dung Story</th>
            <th>Trạng thái</th>
            <th>Hành động</th>
          </tr>
          </thead>
          <tbody>
          <% @stories.each do |story| %>
            <tr>
              <td><%= story.id %></td>
              <td>
                <% if story.kanji %>
                  <span class="badge badge-warning" style="font-size: 1.2em"><%= story.kanji.character %></span>
                <% else %>
                  <span class="text-danger">Trống</span>
                <% end %>
              </td>

              <td style="white-space: normal; max-width: 400px;">
                <%= story.content %>
              </td>

              <td>
                <% if story.pending? %>
                  <span class="badge badge-warning">Chờ duyệt</span>
                <% elsif story.approved? %>
                  <span class="badge badge-success">Đã duyệt</span>
                <% else %>
                  <span class="badge badge-danger">Từ chối</span>
                <% end %>
              </td>

              <td>
                <% if story.pending? %>
                  <%= button_to approve_admin_story_path(story), method: :put, class: "btn btn-success btn-sm mb-1", style: "display:inline-block;" do %>
                    <i class="fas fa-check"></i> Duyệt
                  <% end %>

                  <%= button_to reject_admin_story_path(story), method: :put, class: "btn btn-danger btn-sm", style: "display:inline-block;", onclick: "return confirm('Bạn muốn từ chối story này?')" do %>
                    <i class="fas fa-times"></i> Hủy
                  <% end %>
                <% else %>
                  <span class="text-muted"><i class="fas fa-lock"></i> Đã xử lý</span>
                <% end %>

                <a href="<%= edit_admin_story_path(story) %>" class="btn btn-sm btn-default ml-2">
                  <i class="fas fa-edit"></i>
                </a>
              </td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>